<apex:page standardController="Apttus__APTS_Agreement__c"
    extensions="Apttus_Echosign.SelectAttachmentController" showHeader="true"
    sidebar="true" tabStyle="Apttus__APTS_Agreement__c">
    <apex:form >
        <apex:sectionHeader title="{!$Label.apttus_echosign__SendForESignature}"
            subtitle="{!Apttus__APTS_Agreement__c.Name}" />

        <apex:pageBlock rendered="{!NOT(showOrderPage)}">

            <apex:pageBlockButtons location="top">
                <apex:outputPanel id="idButtonsTopPanel">
                    <apex:commandButton action="{!doSelect}" value="{!$Label.apttus_echosign__Select}"
                        id="cmdButtonDoSelect" disabled="{!attachments.size = 0}" />
                    <apex:commandButton action="{!doCancel}" value="{!$Label.apttus_echosign__Cancel}"
                        id="cmdButtonDoCancel" />
                </apex:outputPanel>
                <b><apex:actionStatus startText="{!$Label.apttus_echosign__StatusMessage}"
                    id="waitStatus" /></b>
            </apex:pageBlockButtons>

            <apex:pageBlockButtons location="bottom">
                <apex:outputPanel id="idButtonsBottomPanel">
                    <apex:commandButton action="{!doSelect}" value="{!$Label.apttus_echosign__Select}"
                        id="cmdButtonDoSelect" disabled="{!attachments.size = 0}" />
                    <apex:commandButton action="{!doCancel}" value="{!$Label.apttus_echosign__Cancel}"
                        id="cmdButtonDoCancel" />
                </apex:outputPanel>
            </apex:pageBlockButtons>
            <apex:pageMessages />
            
            <apex:outputPanel styleClass="searchFilterFields" 
                	rendered="{!AND(hasAssociatedAgmts, enableFilter)}">
                <apex:pageBlockSection title="{!$Label.apttus_echosign__ChooseFilterCriteria}" columns="2"
                    collapsible="false">

                    <apex:panelGrid columns="3" rendered="{!hasParent}">
                        <apex:inputCheckbox value="{!includeParent}" id="includeParent" />
                        <apex:outputLabel value="{!$Label.apttus_echosign__ShowParentAttachments}"
                            for="includeParent" />
                        <apex:actionSupport event="onclick" action="{!doSearch}"
                            rerender="idAttachments, idButtonsTopPanel, idButtonsBottomPanel"
                            status="waitStatus" />
                    </apex:panelGrid>

                    <apex:panelGrid columns="2" rendered="{!hasRelated}">
                        <apex:inputCheckbox value="{!includeRelated}" id="includeRelated" />
                        <apex:outputLabel value="{!$Label.apttus_echosign__ShowRelatedAttachments}"
                            for="includeRelated" />
                        <apex:actionSupport event="onclick" action="{!doSearch}"
                            rerender="idAttachments, idButtonsTopPanel, idButtonsBottomPanel"
                            status="waitStatus" />
                    </apex:panelGrid>

                    <apex:panelGrid columns="2" rendered="{!hasChildren}">
                        <apex:inputCheckbox value="{!includeChildren}"
                            id="includeChildren" />
                        <apex:outputLabel value="{!$Label.apttus_echosign__ShowChildAttachments}"
                            for="includeChildren" />
                        <apex:actionSupport event="onclick" action="{!doSearch}"
                            rerender="idAttachments, idButtonsTopPanel, idButtonsBottomPanel"
                            status="waitStatus" />
                    </apex:panelGrid>

                    <apex:panelGrid columns="2" rendered="{!hasAmendRenew}">
                        <apex:inputCheckbox value="{!includeAmendRenew}"
                            id="includeAmendRenew" />
                        <apex:outputLabel value="{!$Label.apttus_echosign__ShowAmendRenewAttachments}"
                            for="includeAmendRenew" />
                        <apex:actionSupport event="onclick" action="{!doSearch}"
                            rerender="idAttachments, idButtonsTopPanel, idButtonsBottomPanel"
                            status="waitStatus" />
                    </apex:panelGrid>

                    <apex:panelGrid columns="2" rendered="{!hasSiblings}">
                        <apex:inputCheckbox value="{!includeSiblings}"
                            id="includeSiblings" />
                        <apex:outputLabel value="{!$Label.apttus_echosign__ShowSiblingAttachments}"
                            for="includeSiblings" />
                        <apex:actionSupport event="onclick" action="{!doSearch}"
                            rerender="idAttachments, idButtonsTopPanel, idButtonsBottomPanel"
                            status="waitStatus" />
                    </apex:panelGrid>

                </apex:pageBlockSection>

            </apex:outputPanel>

            <apex:outputPanel id="idAttachments">
                <apex:pageBlockSection title="{!$Label.apttus_echosign__SelectAttachments}" columns="1"
                    collapsible="false" rendered="{!attachments.size > 0}">
                    <apex:pageBlockTable value="{!attachments}" var="attachData"
                        width="100%">
                        <apex:column >
                            <apex:facet name="header">{!$Label.apttus_echosign__Select}</apex:facet>
                            <apex:inputCheckbox selected="{!attachData.selected}"
                                value="{!attachData.selected}" />
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">{!$Label.apttus_echosign__FileName}</apex:facet>
                            <apex:outputLink value="/{!attachData.attachment.Id}">{!attachData.attachment.Name}</apex:outputLink>
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">{!$Label.apttus_echosign__AgreementName}</apex:facet>
                            <apex:outputLink value="/{!attachData.agmt.Id}">{!attachData.agmt.Name}</apex:outputLink>
                        </apex:column>
                        <apex:column rendered="{!enableFilter}">
                            <apex:facet name="header">{!$Label.apttus_echosign__Relationship}</apex:facet>
                            <apex:outputText value="{!attachData.agmtAssociationType}" />
                        </apex:column>
                        <apex:column value="{!attachData.agmt.Apttus__FF_Agreement_Number__c}" />
                        <apex:column value="{!attachData.agmt.Apttus__Status__c}" />
                        <apex:column >
                            <apex:facet name="header">{!$Label.apttus_echosign__Size}</apex:facet>
                            <apex:outputText value="{!attachData.attachment.BodyLength}" />
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">{!$Label.apttus_echosign__ModifiedDate}</apex:facet>
                            <apex:outputField value="{!attachData.attachment.LastModifiedDate}" />
                        </apex:column>
                    </apex:pageBlockTable>
                </apex:pageBlockSection>
            </apex:outputPanel>
        </apex:pageBlock>
        

        <apex:pageBlock rendered="{!showOrderPage}">
            <apex:pageBlockButtons >
                <apex:commandButton action="{!doPrevious}" value="{!$Label.apttus_echosign__Previous}" />
                <apex:commandButton action="{!doContinue}" value="{!$Label.apttus_echosign__Next}" />
                <apex:commandButton action="{!doCancel}" value="{!$Label.apttus_echosign__Cancel}" />
            </apex:pageBlockButtons>            

            <apex:pageBlockSection id="idAttachments" title="{!$Label.apttus_echosign__OrderAttachments}" collapsible="false" columns="1">
                <apex:pageBlockTable value="{!selectedAtts}" var="selectedAtt" width="100%" >
                        <apex:column >
                            <apex:commandLink action="{!doMoveDown}" reRender="idAttachments">
                                <apex:outputPanel rendered="{!NOT(selectedAtt.Id = lastAttachmentId)}">
                                    <img src="/img/s.gif" alt="Down"  class="downArrowIcon" title="{!$Label.ImageTitleDown}"/>
                                </apex:outputPanel>
                                <apex:param name="param" assignTo="{!moveDownId}" value="{!selectedAtt.Id}" />
                            </apex:commandLink>
                        </apex:column>
                        <apex:column >
                            <apex:commandLink action="{!doMoveUp}" reRender="idAttachments">
                                <apex:outputPanel rendered="{!NOT(selectedAtt.Id = firstAttachmentId)}">
                                    <img src="/img/s.gif" alt="Up"  class="upArrowIcon" title="{!$Label.ImageTitleUp}"/>
                                </apex:outputPanel>
                                <apex:param name="param" assignTo="{!moveUpId}" value="{!selectedAtt.Id}" />
                            </apex:commandLink>
                        </apex:column>
                    <apex:column >
                        <apex:facet name="header">{!$Label.apttus_echosign__FileName}</apex:facet>
                        <apex:outputLink value="/{!selectedAtt.Id}">{!selectedAtt.Name}</apex:outputLink>
                    </apex:column>
                    <apex:column >
                        <apex:facet name="header">{!$Label.apttus_echosign__Size}</apex:facet>
                        <apex:outputText value="{!selectedAtt.BodyLength}"/>
                    </apex:column>
                    <apex:column >
                        <apex:facet name="header">{!$Label.apttus_echosign__CreatedDate}</apex:facet>
                        <apex:outputText value="{!selectedAtt.CreatedDate}"/>
                    </apex:column>
                </apex:pageBlockTable>
            </apex:pageBlockSection>
        </apex:pageBlock>        
    </apex:form>
</apex:page>